#!/usr/bin/env python3

import re
import sys


def process1(content: str) -> str:
    # move title from header to # heading
    m = re.search(r"title:\s+([^\n]+)", content)
    try:
        title = m.group(1)
        content = re.sub(r'# \{\{ page.title \}\}', "# " + title, content)
    except AttributeError:
        pass
    
    # remove header
    content = re.sub(r"^---.+---\s+(?=#)", "", content, flags=re.S)
    
    # remove separators
    content = re.sub(r"^\* \* \*\s*$", "", content, flags=re.MULTILINE)
    
    return content


for path in sys.argv[1:]:
    content = open(path, "rt").read()
    content = process1(content)
    open(path, "wt").write(content)